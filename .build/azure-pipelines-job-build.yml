parameters:
    DBCVER: ''
    DBCVERNODOTS: ''

jobs:
  - job: Build_${{ parameters.DBCVERNODOTS }}
    variables:
      DBCVER: ${{ parameters.DBCVER }}
    displayName: Build-${{ parameters.DBCVER }}
    pool:
      vmImage: 'ubuntu-latest'
    steps:
      - task: Docker@2
        inputs:
          containerRegistry: 'DockerHub'
          command: login

      - task: Docker@2
        displayName: Build
        inputs:
          command: Build for AMD architecture
          containerRegistry: 'DockerHub'
          repository: datathirstltd/dbconnect
          tags: |
            $(DBCVER)-$(Build.BuildId)
            $(DBCVER)
          arguments: --build-arg DBCVER=$(DBCVER)
      - task: Docker@2
        displayName: Build for ARM architecture
        inputs:
          command: build
          Dockerfile: Dockerfile_ARM64
          containerRegistry: 'DockerHub'
          repository: datathirstltd/dbconnect
          tags: |
            $(DBCVER)-$(Build.BuildId)-arm64
            $(DBCVER)-arm64
          arguments: --build-arg DBCVER=$(DBCVER)
 
      # - task: Docker@2
      #   displayName: Push
      #   inputs:
      #     command: push
      #     containerRegistry: 'DockerHub'
      #     repository: datathirstltd/dbconnect
      #     tags: |
      #       $(DBCVER)-$(Build.BuildId)
      #       $(DBCVER)
      #       $(DBCVER)-$(Build.BuildId)-arm64
      #       $(DBCVER)-arm64
